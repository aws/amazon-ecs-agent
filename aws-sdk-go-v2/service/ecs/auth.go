// Code generated by smithy-go-codegen DO NOT EDIT.


package ecs

import (
	awsmiddleware "github.com/aws/aws-sdk-go-v2/aws/middleware"
	"context"
	"github.com/aws/smithy-go/middleware"
	smithyauth "github.com/aws/smithy-go/auth"
	smithyhttp "github.com/aws/smithy-go/transport/http"
)

func bindAuthParamsRegion( _ interface{}, params *AuthResolverParameters, _ interface{}, options Options) error {
    params.Region = options.Region
    return nil
}

type setLegacyContextSigningOptionsMiddleware struct {
	
}

func (*setLegacyContextSigningOptionsMiddleware) ID() string {
	return "setLegacyContextSigningOptions"
}

func (m *setLegacyContextSigningOptionsMiddleware) HandleFinalize(ctx context.Context, in middleware.FinalizeInput, next middleware.FinalizeHandler) (
	out middleware.FinalizeOutput, metadata middleware.Metadata, err error,
) {
	rscheme := getResolvedAuthScheme(ctx)
	schemeID := rscheme.Scheme.SchemeID()
	
	if sn := awsmiddleware.GetSigningName(ctx); sn != "" {
	    if schemeID == "aws.auth#sigv4" {
	        smithyhttp.SetSigV4SigningName(&rscheme.SignerProperties, sn)
	    } else if schemeID == "aws.auth#sigv4a" {
	        smithyhttp.SetSigV4ASigningName(&rscheme.SignerProperties, sn)
	    }
	}
	
	if sr := awsmiddleware.GetSigningRegion(ctx); sr != "" {
	    if schemeID == "aws.auth#sigv4" {
	        smithyhttp.SetSigV4SigningRegion(&rscheme.SignerProperties, sr)
	    } else if schemeID == "aws.auth#sigv4a" {
	        smithyhttp.SetSigV4ASigningRegions(&rscheme.SignerProperties, []string{sr})
	    }
	}
	
	return next.HandleFinalize(ctx, in)
}

func addSetLegacyContextSigningOptionsMiddleware(stack *middleware.Stack) error {
    return stack.Finalize.Insert(&setLegacyContextSigningOptionsMiddleware{}, "Signing", middleware.Before)
}

type withAnonymous struct {
    resolver AuthSchemeResolver
}

var _ AuthSchemeResolver = (*withAnonymous)(nil)

func (v *withAnonymous) ResolveAuthSchemes(ctx context.Context, params *AuthResolverParameters) ([]*smithyauth.Option, error) {
    opts, err := v.resolver.ResolveAuthSchemes(ctx, params)
    if err != nil {
        return nil, err
    }

    opts = append(opts, &smithyauth.Option{
        SchemeID: smithyauth.SchemeIDAnonymous,
    })
    return opts, nil
}

func wrapWithAnonymousAuth(options *Options) {
    if _, ok := options.AuthSchemeResolver.(*defaultAuthSchemeResolver); !ok {
        return
    }

    options.AuthSchemeResolver = &withAnonymous{
        resolver: options.AuthSchemeResolver,
    }
}
